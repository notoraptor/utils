algo = DEFAULT
reuse = false

def computeHash(...)
def choose()
	if time
		algo chosen with worksize
	if guess
		algo chosen without worksize
def fallback(algo)

if choose_algo
	if choose_once
		if not reuse
			algo = choose()
			algo = fallback(algo)
			reuse = true
	else // choose_on_shape_change
		hash = computeHash()
		rec = cache.find(hash)
		if rec
			algo = rec
		else
			algo = choose()
			algo = fallback(algo)
			cache.add(hash, algo)
else
	algo = fallback(algo)